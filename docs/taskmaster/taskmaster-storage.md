# Taskmaster Storage System

The Taskmaster Storage System is a real filesystem-based implementation for task storage and retrieval that replaces the simulated commands in the original Taskmaster workflow scripts.

## Overview

This system provides a robust solution for storing, retrieving, and managing tasks with the following key features:

- File-based JSON storage for tasks
- Task action logging
- Parent-child task relationships (subtasks)
- Phase-based task organization
- Prioritized task retrieval
- Command-line interface for direct interaction

## Architecture

The Taskmaster Storage System consists of the following components:

1. **Storage Module (`taskmaster-storage.js`)**: Core functionality for CRUD operations on tasks
2. **CLI Tool (`taskmaster-storage-cli.js`)**: Command-line interface for direct interaction
3. **Initialization Script (`taskmaster-init.js`)**: Sets up sample tasks for testing/demos
4. **Integration with Workflows**: Updated taskmaster workflow scripts to use real storage

## File Structure

Tasks are stored in a JSON file located at:

```json
./data/taskmaster/tasks.json
```

Activity logs are stored in the `logs` directory with one file per day:

```json
./data/taskmaster/logs/YYYY-MM-DD.log
```

## Task Model

Tasks follow this structure:

```javascript
{
  id: "a1b2c3d4",              // Unique identifier (autogenerated)
  title: "Task title",         // Task title
  description: "Description",  // Task description
  status: "todo",              // Status: 'todo', 'in-progress', 'completed', 'blocked'
  priority: "medium",          // Priority: 'low', 'medium', 'high', 'critical'
  parentId: null,              // Parent task ID (for subtasks)
  phase: "implementation",     // Development phase
  createdAt: 1234567890,       // Timestamp of creation
  updatedAt: 1234567890,       // Timestamp of last update
  completedAt: null            // Timestamp of completion (null if not completed)
}
```

## API Reference

### Core Storage Functions

- `createTask({ title, description, status, priority, parentId, phase })`: Creates a new task
- `updateTask(id, updates)`: Updates an existing task with the provided changes
- `deleteTask(id)`: Deletes a task by ID
- `getAllTasks()`: Returns all tasks
- `getTaskById(id)`: Returns a specific task by ID
- `getSubtasks(parentId)`: Returns all subtasks for a parent task
- `getCurrentTask()`: Returns the current in-progress task
- `getNextTask(phase)`: Returns the next task to work on, optionally filtered by phase

### Command Execution

- `executeCommand(args)`: Executes a taskmaster command and returns the result

## CLI Usage

The CLI tool provides a direct interface to the storage system:

```bash
node scripts/taskmaster-storage-cli.js <command> [args]
```

Available commands:

- `list`: Lists all tasks
- `next [phase]`: Gets the next task to work on (optional phase filter)
- `current`: Gets the current in-progress task
- `subtasks <parentId>`: Gets subtasks for a parent task
- `task <taskId>`: Gets a specific task by ID
- `create <title> [desc] [prio] [parentId] [phase]`: Creates a new task
- `update <taskId> <field> <value>`: Updates a task
- `delete <taskId>`: Deletes a task
- `help`: Shows help information

## npm Scripts

The following npm scripts are available for working with the taskmaster storage:

- `npm run taskmaster:init`: Initialize taskmaster with sample tasks
- `npm run taskmaster:storage-reset`: Reset the taskmaster storage
- `npm run taskmaster:storage-check`: View the current tasks JSON file
- `npm run taskmaster:cli`: Run the CLI tool (requires command)
- `npm run taskmaster:cli-list`: List all tasks
- `npm run taskmaster:cli-current`: Show the current task

## GitHub Actions Integration

The Taskmaster Storage System integrates with GitHub Actions workflows to provide task management capabilities in CI/CD pipelines. The workflow in `.github/workflows/taskmaster.yml` has been updated to:

1. Initialize the taskmaster storage if needed
2. Check current tasks
3. Start/complete tasks
4. Create pull requests for completed tasks
5. Upload taskmaster data as an artifact for persistence

## Migration from Simulation

In the original implementation, task commands were simulated with hardcoded responses. The new implementation provides actual storage and retrieval of tasks with the same command interface, allowing existing scripts to work with minimal changes.

Key changes:

1. Replaced simulated `taskmaster` function with real implementation
2. Updated task expansion to use the storage system
3. Enhanced the dashboard with real task metrics
4. Added CLI tool for direct interaction with the storage

## Next Steps

Future enhancements to consider:

1. Database storage option for larger task sets
2. Multi-user support with task assignments
3. Enhanced task analytics and reporting
4. Web interface for task management
